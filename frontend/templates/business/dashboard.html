<!-- {# templates/dashboard_base.html #}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}Dashboard{% endblock %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans antialiased">


</body>
</html> -->

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Pre 칍rdenes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#f7f3f3',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100">

    <!-- Navbar -->
    <!-- <header class="flex items-center justify-between bg-white px-4 py-2 shadow md:hidden">
        <button id="menuBtn" class="text-2xl">&#9776;</button>
        <h1 class="text-lg font-semibold">Dashboard</h1>
    </header> -->

    <!-- Sidebar -->
    <!-- <aside id="sidebar" class="fixed top-0 left-0 w-64 h-full bg-white shadow transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-50">
        <div class="p-4 border-b flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-10 h-10 bg-gray-300 rounded-full"></div>
                <div class="text-sm">
                    <p class="font-medium">name Business</p>
                </div>
            </div> -->
            <!-- Bot칩n para cerrar el men칰 en m칩viles -->
            <!-- <button id="closeBtn" class="md:hidden text-xl font-bold">&times;</button>
        </div>
        <nav class="p-4 text-sm space-y-4">
            <a href="#" class="block hover:text-blue-500 toggleSidebar">Dashboard</a>
            <a href="#" class="block hover:text-blue-500 toggleSidebar">Pre 칩rdenes</a>
            <a href="#" class="block hover:text-blue-500 toggleSidebar">Opciones</a>
            <a href="#" class="block hover:text-red-500 toggleSidebar">Logout</a>
        </nav>
    </aside> -->

      {% include "business/navbar.html" %}    
        <!-- {{request.session.unique_business}} -->
        <!-- {{business}} -->
       <!-- Main -->
    <main class="px-2 py-4 md:ml-64 transition-all duration-300">
        <!-- Card business -->
        <div class="bg-primary rounded-2xl border flex  flex-col sm:flex-row justify-between items-center shadow">
            <div class="space-y-1 text-center sm:text-left">
                <h2 class="text-xl font-bold">Negocio: <span class="text-gray-700">{{request.session.unique_business.name}}</span></h2>
                <!-- <p class="text-gray-600">Total 칍rdenes: 152</p>
                <p class="text-gray-600">En curso: 5</p> -->
                <p class="text-gray-600">Ganancias este mes: S/ 3,200</p>
                <p class="text-green-600 font-semibold">Estado: {{request.session.unique_business.status}}</p>
            </div>
               <!-- <div class="w-24 h-24 bg-gray-300 rounded-full mt-4 sm:mt-0"></div> -->
        </div>

        <!-- Graficas -->
        
        <!-- 游늵 Gr치fico -->
        <div class="chart-container w-full h-96 mb-6">
        <canvas id="gananciaChart"></canvas>
        </div>


        <!-- FeedBack -->
        <!-- Grid Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            <div class="bg-white shadow rounded p-4">
                <h3 class="text-sm text-gray-500">칍rdenes hoy</h3>
                <!-- <p class="text-2xl font-bold">{{ request.session.unique_business.orders | length }}</p> -->
                <p class="text-2xl font-bold"><span id="orders-count">0</span></p>
            </div>
            <div class="bg-white shadow rounded p-4">
                <h3 class="text-sm text-gray-500">Ganancias hoy</h3>
                <p class="text-2xl font-bold">S/ <span id= "earn-today">0</span> </p>
            </div>
            <div class="bg-white shadow rounded p-4">
                <h3 class="text-sm text-gray-500">Clientes nuevos</h3>
                <p class="text-2xl font-bold">3</p>
            </div>
        </div>
        
        <div>
            
        </div>

        
        
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
           
                <h3 class="text-sm text-gray-500">comentarios</h3>
                <p class="text-2xl font-bold">usuario 1</p>
           
        </div>


    <!-- 游늷 C칩digo para el gr치fico -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



    </main>




<script>
  const ctAx = document.getElementById('gananciaChart').getContext('2d');

  new Chart(ctAx, {
    type: 'bar', // Puedes cambiar a 'line' si quieres gr치fico lineal
    data: {
      labels: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio','Julio','Agosto'], // Meses
      datasets: [{
        label: 'Ganancia (USD)',
        data: [8500, 9200, 7800, 10000, 9500, 11000], // Ganancia por mes
        backgroundColor: 'rgba(54, 162, 235, 0.6)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>




    <!-- JS Toggle -->
    <script>
        const sidebar = document.getElementById('sidebar');
        const menuBtn = document.getElementById('menuBtn');
        const closeSidebarItems = document.querySelectorAll('.close-sidebar');
        const closeMenuOnClick = document.getElementById('closeMenuOnClick');

        // Abrir/cerrar men칰 en celulares
        menuBtn.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
        });

        // Cerrar men칰 al hacer click en un enlace del sidebar
        closeSidebarItems.forEach(item => {
            item.addEventListener('click', () => {
                if (window.innerWidth < 768) {
                    sidebar.classList.add('-translate-x-full');
                }
            });
        });

        // Cerrar men칰 al dar clic en el t칤tulo
        closeMenuOnClick.addEventListener('click', () => {
            if (window.innerWidth < 768) {
                sidebar.classList.add('-translate-x-full');
            }
        });
    </script>



<script>
    function updateCustomers() {
        
        
    }
</script>

<script>
    function updateEarnList(){

    }
</script>

<!-- 
<script>

function updateOrdersCount() {
    // Obtener el ID (ajusta seg칰n c칩mo lo obtengas)
    const id = "{{request.session.unique_business.id}}";  // Ejemplo: podr칤a ser {{ user.id }}, localStorage, etc.
    
    console.log(id)
    fetch("{% url 'orders_analytics' %}", {
        method: "POST",
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'  // Necesario para Django CSRF protection
        },
        body: JSON.stringify({ id: id })  // Env칤a el ID en el cuerpo como JSON
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Error en la respuesta del servidor');
        }
        return response.json();
    })
    .then(data => {
        console.log("Respuesta del servidor:", data);

        if (typeof data.total !== "undefined") {
            
            // definir la informacion obtenida
            document.getElementById("earn-today").textContent = data.earn_today
            document.getElementById("orders-count").textContent = data.total.length;
        } 
        else if (typeof data.count !== "undefined") {
            document.getElementById("orders-count").textContent = data.count;
        } 
        else {
            console.warn("Formato inesperado de datos:", data);
        }
    })
    .catch(error => {
        console.error("Error obteniendo 칩rdenes:", error);
    });
}

// Ejecutar al cargar
updateOrdersCount();

// Actualizar cada 5 segundos
setInterval(updateOrdersCount, 5000);
</script> -->
<script>
    // const businessId = "{{request.session.unique_business.id}}";  // Ejemplo: podr칤a ser {{ user.id }}, localStorage, etc.
    // const businessId = document.getElementById("orders-container").dataset.businessId;
    const eventSource = new EventSource("{% url 'orders_stream' request.session.unique_business.id %}");

    eventSource.onmessage = function(event) {
        const data = JSON.parse(event.data);
        const ordersCountElem = document.getElementById("orders-count");
        const earnTodayElem =  document.getElementById("earn-today");

        console.log(data.earn_today)

        console.log(data)
        if (ordersCountElem) {
            earnTodayElem.textContent = data.earn_today;
            ordersCountElem.textContent = data.total.length;
        }
    };


    // eventSource.onmessage = function(event) {
    //     const data = JSON.parse(event.data);
    //     console.log("칍rdenes actualizadas:", data);
    //     document.getElementById("orders-container").innerText = JSON.stringify(data, null, 2);
    // };

    eventSource.onerror = function() {
        console.error("Error en la conexi칩n SSE");
    };
</script>

</body>
</html>



<script>

     function updaerBusinessDashboard(params) {
        

     }

</script>